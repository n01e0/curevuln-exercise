### 対策方法の解説
#### 正規利用者の意図したリクエストであることの確認
正規利用者の意図したリクエストであることを確認するには、以下の手法を使います。

 - 第3者の知り得ない秘密情報（トークン）を要求するようにします。具体的には予測困難性を持つ暗号論的強度の高い疑似乱数生成器を使ってトークンを生成します。
 - 利用者が本当に意図しているかどうかを確認するために、パスワードの再入力を求めることも有効です。具体的には「重要な処理」を実行するための本人確認を行います。
 - Refererを確認することで、どのページから遷移してきたかわかるため、正規のリクエストとして状態遷移していることが確認できます。ただしこの方法には次項に述べる制限事項があります。

#### Refererの確認による対策の限界
 Refererの確認による対策が有効なのはRefererを送信できる相手に限ります。
 
 ```https://``` から ```http://``` への遷移では、Refererは送信されません。そのため、攻撃者の罠サイトがhttpsであり、Refererを確認する方式のCSRF対策を施しているサイトがhttpである場合は、CSRF攻撃が成立します。
 
 ブラウザのプライバシー保護の拡張機能によっては、Refererを送信しないものがあります。このような拡張機能を使用する際は常に画面遷移が失敗してしまうということになることに留意する必要があります。この場合の対策としては、Refererが空であることを許容するという方針ではなく、Refererヘッダを有効にする旨を促すエラー画面を出力することが推奨されます。一例として、BitBucketではRefererヘッダを無効にしている場合、次のような画面に遷移します。

#### 保険的対策
「重要な処理」の実行後に、対象利用者の登録済みメールアドレスに対して、処理内容の通知メールを送信することが保険的対策として有効です。CSRFに加え、XSS攻撃を受けた際に利用者が早期に気づくことができ被害の軽減につながるからです。

ただし、メールは平文で送信され誰でも読めてしまうため、「重要な処理」が実行されたのみを通知するにとどめ、重要情報は含めないようにします。正規利用者は詳細な内容を知りたければ、Webアプリケーションにログインして確認できるからです。
